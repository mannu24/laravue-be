import{c as S,o as c,j as U,w as n,M as O,n as N,e as t,s as ee,ad as te,T as se,U as ae,ae as ne,J as le,af as oe,aa as re,r as b,b as h,F as H,h as Y,d as a,f as s,t as v,l as q,g as x,i as $,ag as ie,a as ue,C as I,P as ce,X as M,a5 as de,a3 as pe,m as ve,z as me}from"./app-BYKYNp4m.js";import{_ as P,a as E}from"./CardContent-C-Vk5b1h.js";import{_ as D,a as Q,b as fe}from"./CardTitle-DD1DMKAN.js";import{_ as W}from"./CardFooter-CQ0oXYle.js";import{a as he,_ as ye}from"./BackNavigator-C7a6kw1k.js";import{M as Z}from"./message-square-O30cgJkM.js";import{E as _e}from"./eye-bwSVoMEn.js";/**
 * @license lucide-vue-next v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=S("ChevronUpIcon",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-vue-next v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=S("CircleAlertIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-vue-next v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=S("CircleChevronUpIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m8 14 4-4 4 4",key:"fy2ptz"}]]);/**
 * @license lucide-vue-next v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=S("LockIcon",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-vue-next v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=S("PenLineIcon",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]]),X={__name:"Avatar",props:{class:{type:null,required:!1},size:{type:null,required:!1,default:"sm"},shape:{type:null,required:!1,default:"circle"}},setup(f){const g=f;return(w,m)=>(c(),U(t(te),{class:N(t(ee)(t($e)({size:f.size,shape:f.shape}),g.class))},{default:n(()=>[O(w.$slots,"default")]),_:3},8,["class"]))}},G={__name:"AvatarFallback",props:{delayMs:{type:Number,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},setup(f){const g=f;return(w,m)=>(c(),U(t(ne),se(ae(g)),{default:n(()=>[O(w.$slots,"default")]),_:3},16))}},K={__name:"AvatarImage",props:{src:{type:String,required:!0},referrerPolicy:{type:null,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},setup(f){const g=f;return(w,m)=>(c(),U(t(oe),le(g,{class:"h-full w-full object-cover"}),null,16))}},$e=re("inline-flex items-center justify-center font-normal text-foreground select-none shrink-0 bg-secondary overflow-hidden",{variants:{size:{sm:"h-10 w-10 text-xs",base:"h-16 w-16 text-2xl",lg:"h-32 w-32 text-5xl"},shape:{circle:"rounded-full",square:"rounded-md"}}}),be={class:"space-y-4"},Ce={class:"flex gap-4 p-4 dark:bg-gray-950 border-[1px] rounded-lg shadow"},qe={key:0,class:"flex flex-col items-center"},Ae=["onClick"],ze={class:"text-sm font-medium"},Le={class:"flex-1"},Re=["innerHTML"],Ue={class:"flex items-center justify-between mt-4"},Me={class:"flex items-center gap-4 text-sm text-gray-500"},Se={class:"flex items-center gap-2"},Fe={class:"flex items-center gap-2"},Te={key:0,class:"mt-4 border-l-2 border-primary pl-4"},Be={class:"flex justify-end mt-2 space-x-2"},je={key:0,class:"mt-2"},Ve={class:"flex gap-4 p-4 dark:bg-gray-950 border-[1px] rounded-lg shadow"},Ie={key:0,class:"flex flex-col items-center"},Pe=["onClick"],Ee={class:"text-sm font-medium"},Ne={class:"flex-1"},He=["innerHTML"],Ye={class:"flex items-center justify-between mt-4"},De={class:"flex items-center gap-4 text-sm text-gray-500"},Qe={class:"flex items-center gap-2"},We={key:0,class:"ml-6 pl-4 mt-2"},Je={__name:"AnswersWithReplies",props:{items:{type:Array,required:!0},authUserId:{type:Number,required:!0},maxReplies:{type:Number,default:0}},emits:["reply","upvote"],setup(f,{emit:g}){const w=f,m=g,L=b({}),y=b({});b({});const k=b({}),u=o=>{L.value[o]=!L.value[o],L.value[o]||(y.value[o]="")},C=o=>{const d=y.value[o];d!=null&&d.trim()&&(m("reply",{parentId:o,content:d}),u(o))},F=o=>{k.value[o]=!k.value[o]},T=o=>{const d=w.items.find(l=>l.id===o);return!d||!d.replies?[]:k.value[o]?d.replies:d.replies.slice(0,w.maxReplies)},A=o=>new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric"}).format(new Date(o)),B=o=>o?o.split(" ").map(d=>d[0]).join("").toUpperCase():"?";return(o,d)=>(c(),h("div",be,[(c(!0),h(H,null,Y(f.items,l=>{var j,V;return c(),h("div",{key:l.id,class:N(["relative",{"pl-[20px]":o.depth>0}])},[a("div",Ce,[((j=l.user)==null?void 0:j.id)!==f.authUserId?(c(),h("div",qe,[a("button",{onClick:()=>o.$emit("upvote",l.id),class:N(["p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",{"text-primary":l.hasUpvoted}])},[s(t(J),{class:"h-5 w-5"})],10,Ae),a("span",ze,v(l.upvotes||0),1)])):q("",!0),a("div",Le,[a("div",{innerHTML:l.content,class:"prose dark:prose-invert max-w-none text-sm"},null,8,Re),a("div",Ue,[a("div",Me,[a("div",Se,[s(t(X),{class:"h-6 w-6"},{default:n(()=>{var p;return[s(t(K),{src:(p=l.user)==null?void 0:p.avatar_url},null,8,["src"]),s(t(G),{class:"text-white"},{default:n(()=>{var z;return[x(v(B((z=l.user)==null?void 0:z.name)),1)]}),_:2},1024)]}),_:2},1024),a("span",null,v(((V=l.user)==null?void 0:V.name)||"Anonymous"),1)]),a("span",null,v(A(l.created_at)),1)]),a("div",Fe,[s(t($),{variant:"ghost",size:"sm",onClick:p=>u(l.id)},{default:n(()=>[s(t(Z),{class:"h-4 w-4 mr-1"}),d[0]||(d[0]=x(" Reply "))]),_:2},1032,["onClick"])])]),L.value[l.id]?(c(),h("div",Te,[s(he,{modelValue:y.value[l.id],"onUpdate:modelValue":p=>y.value[l.id]=p,placeholder:"Write your reply...","min-height":100},null,8,["modelValue","onUpdate:modelValue"]),a("div",Be,[s(t($),{variant:"outline",size:"sm",onClick:p=>u(l.id)},{default:n(()=>d[1]||(d[1]=[x("Cancel")])),_:2},1032,["onClick"]),s(t($),{size:"sm",onClick:p=>C(l.id)},{default:n(()=>d[2]||(d[2]=[x("Post Reply")])),_:2},1032,["onClick"])])])):q("",!0)])]),l.replies&&l.replies.length>0?(c(),h("div",je,[(c(!0),h(H,null,Y(T(l.id),p=>{var z,r;return c(),h("div",{key:p.id,class:"ml-6 border-l-2 border-gray-200 pl-4 py-2"},[a("div",Ve,[((z=p.user)==null?void 0:z.id)!==f.authUserId?(c(),h("div",Ie,[a("button",{onClick:e=>o.$emit("upvote",{id:p.id,type:"answer"}),class:"p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"},[s(t(J),{class:"h-5 w-5"})],8,Pe),a("span",Ee,v(p.upvotes_count||0),1)])):q("",!0),a("div",Ne,[a("div",{innerHTML:p.content,class:"prose dark:prose-invert max-w-none text-sm"},null,8,He),a("div",Ye,[a("div",De,[a("div",Qe,[s(t(X),{class:"h-6 w-6"},{default:n(()=>{var e;return[s(t(K),{src:(e=p.user)==null?void 0:e.avatar_url},null,8,["src"]),s(t(G),{class:"text-white"},{default:n(()=>{var i;return[x(v(B((i=p.user)==null?void 0:i.name)),1)]}),_:2},1024)]}),_:2},1024),a("span",null,v(((r=p.user)==null?void 0:r.name)||"Anonymous"),1)]),a("span",null,v(A(p.created_at)),1)])])])])])}),128)),l.replies.length>f.maxReplies?(c(),h("div",We,[s(t($),{variant:"ghost",size:"sm",onClick:p=>F(l.id),class:"text-gray-500 hover:text-gray-700 dark:hover:text-gray-400"},{default:n(()=>[x(v(k.value[l.id]?"Show Less":`Show More (${l.replies.length-f.maxReplies} more)`),1)]),_:2},1032,["onClick"])])):q("",!0)])):q("",!0)],2)}),128))]))}},Xe={class:"max-w-4xl mx-auto py-8 px-4"},Ge={key:0,class:"text-center"},Ke={key:1,class:"space-y-6"},Oe={class:"flex items-center justify-between"},Ze=["innerHTML"],et={class:"flex space-x-4"},tt={class:"flex items-center space-x-1"},st={class:"text-sm text-gray-500"},at={key:0,class:"flex items-center space-x-1"},nt={class:"text-sm text-gray-500"},lt={class:"flex justify-end mt-4"},ot={class:"space-x-4"},rt={class:"space-y-4"},it={class:"text-lg font-medium"},ut={key:2,class:"text-center py-12"},yt={__name:"QuestionDetail",setup(f){const g=de(),w=ve(),{toast:m}=ie(),L=ue(),y=I(()=>L.token),k=b(!1),u=b(null),C=b([]),F=b(""),T=b(!0),A=b(!1),B=[{name:"Questions",href:"/qna"},{name:g.params.slug,href:"/qna/"+g.params.slug}],o=I(()=>{if(!u.value)return"";const r=300;return u.value.content.length<=r||A.value?u.value.content:u.value.content.slice(0,r)+"..."}),d=I(()=>u.value&&u.value.content.length>300);ce(async()=>{var r,e;try{await l()}catch(i){m({title:"Error",description:((e=(r=i==null?void 0:i.response)==null?void 0:r.data)==null?void 0:e.message)||"Failed to fetch question details.",variant:"destructive"})}finally{T.value=!1}});const l=async()=>{const r=await M.get(`/api/v1/questions/${g.params.slug}`);u.value=r.data.data.question,C.value=r.data.data.answers},j=async()=>{var r,e;try{const i=await M.post(`/api/v1/questions/${u.value.id}/answers`,{content:F.value},{headers:{Authorization:`Bearer ${y.value}`}});C.value.push(i.data.data),F.value="",k.value=!1,m({title:"Answer submitted",description:"Your answer has been posted."})}catch(i){m({title:"Error",description:((e=(r=i==null?void 0:i.response)==null?void 0:r.data)==null?void 0:e.message)||"Failed to submit answer.",variant:"destructive"})}},V=async()=>{var r,e;if(!y.value)return m({title:"Authentication required",description:"Log in to upvote.",variant:"warning"});try{await M.post(`/api/v1/questions/${u.value.id}/upvote`,{},{headers:{Authorization:`Bearer ${y.value}`}}),u.value.upvotes_count++,m({title:"Upvoted",description:"You upvoted this question."})}catch(i){m({title:"Error",description:((e=(r=i==null?void 0:i.response)==null?void 0:r.data)==null?void 0:e.message)||"Failed to upvote question.",variant:"destructive"})}},p=async({parentId:r,content:e})=>{var i,_;if(!y.value)return m({title:"Authentication required",description:"Log in to reply.",variant:"warning"});try{const R=await M.post(`/api/v1/answers/${r}/replies`,{content:e},{headers:{Authorization:`Bearer ${y.value}`}});m({title:"Reply submitted",description:"Your reply has been posted."}),await l()}catch(R){m({title:"Error",description:((_=(i=R==null?void 0:R.response)==null?void 0:i.data)==null?void 0:_.message)||"Failed to submit reply.",variant:"destructive"})}},z=async r=>{var e,i;if(!y.value)return m({title:"Authentication required",description:"Log in to upvote.",variant:"warning"});try{await M.post(`/api/v1/answers/${r}/upvote`,{},{headers:{Authorization:`Bearer ${y.value}`}});const _=C.value.find(R=>R.id===r);_&&_.upvotes_count++,m({title:"Upvoted",description:"You upvoted this answer."})}catch(_){m({title:"Error",description:((i=(e=_==null?void 0:_.response)==null?void 0:e.data)==null?void 0:i.message)||"Failed to upvote answer.",variant:"destructive"})}};return(r,e)=>{const i=me("Spinner");return c(),h("div",Xe,[T.value?(c(),h("div",Ge,[s(i,{class:"h-8 w-8 text-primary"}),e[5]||(e[5]=a("p",{class:"mt-2 text-gray-600"},"Loading question...",-1))])):u.value?(c(),h("div",Ke,[s(ye,{items:B}),s(t(E),null,{default:n(()=>[s(t(D),null,{default:n(()=>[a("div",Oe,[s(t(Q),{class:"text-2xl font-bold"},{default:n(()=>[x(v(u.value.title),1)]),_:1}),s(t($),{onClick:V,variant:"outline",size:"sm",class:"flex items-center space-x-1"},{default:n(()=>[s(t(ge),{class:"h-6 w-6"}),a("span",null,v(u.value.upvotes_count),1)]),_:1})]),s(t(fe),{class:"flex items-center space-x-2 text-sm text-gray-500"},{default:n(()=>[s(t(pe),{class:"h-4 w-4"}),a("span",null,v(u.value.user?u.value.user.name:"Anonymous"),1),e[6]||(e[6]=a("span",null,"•",-1)),a("span",null,v(u.value.created_at),1)]),_:1})]),_:1}),s(t(P),null,{default:n(()=>[a("div",{innerHTML:o.value,class:"prose max-w-none"},null,8,Ze),d.value?(c(),U(t($),{key:0,onClick:e[0]||(e[0]=_=>A.value=!A.value),variant:"link",class:"mt-2"},{default:n(()=>[x(v(A.value?"Show less":"Read more"),1)]),_:1})):q("",!0)]),_:1}),s(t(W),{class:"flex justify-between items-center"},{default:n(()=>[a("div",et,[a("span",tt,[s(t(Z),{class:"h-4 w-4 text-gray-500"}),a("span",st,v(C.value.length)+" Answers",1)]),u.value.views_count?(c(),h("span",at,[s(t(_e),{class:"h-4 w-4 text-gray-500"}),a("span",nt,v(u.value.views_count)+" Views",1)])):q("",!0)])]),_:1})]),_:1}),a("div",lt,[s(t($),{variant:"outline",size:"lg",onClick:e[1]||(e[1]=_=>k.value=!k.value),class:"gap-2"},{default:n(()=>[s(t(ke),{class:"h-4 w-4"}),x(" "+v(k.value?"Hide Answer Form":"Write an Answer"),1)]),_:1})]),k.value&&y.value?(c(),U(t(E),{key:0,class:"mt-4"},{default:n(()=>[s(t(D),null,{default:n(()=>[s(t(Q),null,{default:n(()=>e[7]||(e[7]=[x("Your Answer")])),_:1})]),_:1}),s(t(P)),s(t(W),{class:"flex justify-end"},{default:n(()=>[s(t($),{onClick:j},{default:n(()=>e[8]||(e[8]=[x("Post Your Answer")])),_:1})]),_:1})]),_:1})):k.value&&!y.value?(c(),U(t(E),{key:1},{default:n(()=>[s(t(P),{class:"text-center py-6"},{default:n(()=>[s(t(we),{class:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e[11]||(e[11]=a("p",{class:"text-lg font-semibold mb-2"},"Sign up or log in to answer",-1)),e[12]||(e[12]=a("p",{class:"text-gray-500 mb-4"},"You need to be logged in to post an answer to this question.",-1)),a("div",ot,[s(t($),{onClick:e[2]||(e[2]=_=>t(w).push("/login"))},{default:n(()=>e[9]||(e[9]=[x("Log in")])),_:1}),s(t($),{onClick:e[3]||(e[3]=_=>t(w).push("/signup")),variant:"outline"},{default:n(()=>e[10]||(e[10]=[x("Sign up")])),_:1})])]),_:1})]),_:1})):q("",!0),a("div",rt,[a("h2",it,v(C.value.length)+" Answers",1),s(Je,{items:C.value,"auth-user-id":r.authUserId,"max-replies":2,onReply:p,onUpvote:z},null,8,["items","auth-user-id"])])])):(c(),h("div",ut,[s(t(xe),{class:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e[14]||(e[14]=a("p",{class:"text-xl font-semibold"},"Question not found",-1)),e[15]||(e[15]=a("p",{class:"text-gray-500 mt-2"},"The question you're looking for doesn't seem to exist.",-1)),s(t($),{onClick:e[4]||(e[4]=_=>t(w).push("/questions")),variant:"link",class:"mt-4"},{default:n(()=>e[13]||(e[13]=[x("Browse all questions")])),_:1})]))])}}};export{yt as default};
//# sourceMappingURL=QuestionDetail-PPj_Hsjt.js.map
