{"version":3,"file":"useAutoTaskCompletion-B0y9nFtT.js","sources":["../../../resources/js/stores/taskStore.js","../../../resources/js/composables/useAutoTaskCompletion.js"],"sourcesContent":["/**\r\n * Task Store\r\n * Manages tasks and task completion\r\n */\r\nimport { defineStore } from 'pinia'\r\nimport { ref, computed } from 'vue'\r\nimport api from '@/lib/api'\r\nimport endpoints from '@/lib/endpoints'\r\n\r\nexport const useTaskStore = defineStore('task', () => {\r\n  // State\r\n  const loading = ref(false)\r\n  const error = ref(null)\r\n  const dailyTasks = ref([])\r\n  const weeklyTasks = ref([])\r\n\r\n  // Getters\r\n  const todayTasks = computed(() => dailyTasks.value)\r\n  const weekTasks = computed(() => weeklyTasks.value)\r\n\r\n  /**\r\n   * Fetch daily tasks for user\r\n   * @param {number|string} userId - User ID\r\n   */\r\n  const fetchDailyTasks = async (userId) => {\r\n    try {\r\n      loading.value = true\r\n      error.value = null\r\n      const response = await api.get(endpoints.tasks.daily(userId))\r\n      dailyTasks.value = response.data.data\r\n      return response.data.data\r\n    } catch (err) {\r\n      error.value = err.response?.data?.message || 'Failed to fetch daily tasks'\r\n      throw err\r\n    } finally {\r\n      loading.value = false\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Fetch weekly tasks for user\r\n   * @param {number|string} userId - User ID\r\n   */\r\n  const fetchWeeklyTasks = async (userId) => {\r\n    try {\r\n      loading.value = true\r\n      error.value = null\r\n      const response = await api.get(endpoints.tasks.weekly(userId))\r\n      weeklyTasks.value = response.data.data\r\n      return response.data.data\r\n    } catch (err) {\r\n      error.value = err.response?.data?.message || 'Failed to fetch weekly tasks'\r\n      throw err\r\n    } finally {\r\n      loading.value = false\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Complete a task\r\n   * @param {number|string} taskId - Task ID\r\n   * @param {number|string} userId - User ID\r\n   */\r\n  const completeTask = async (taskId, userId) => {\r\n    try {\r\n      loading.value = true\r\n      error.value = null\r\n      const response = await api.post(endpoints.tasks.complete(), {\r\n        task_id: taskId,\r\n        user_id: userId\r\n      })\r\n      // Refresh tasks after completion\r\n      await fetchDailyTasks(userId)\r\n      await fetchWeeklyTasks(userId)\r\n      return response.data.data\r\n    } catch (err) {\r\n      error.value = err.response?.data?.message || 'Failed to complete task'\r\n      throw err\r\n    } finally {\r\n      loading.value = false\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Assign task to user\r\n   * @param {number|string} taskId - Task ID\r\n   * @param {number|string} userId - User ID\r\n   */\r\n  const assignTask = async (taskId, userId) => {\r\n    try {\r\n      loading.value = true\r\n      error.value = null\r\n      const response = await api.post(endpoints.tasks.assign(), {\r\n        task_id: taskId,\r\n        user_id: userId\r\n      })\r\n      // Refresh tasks after assignment\r\n      await fetchDailyTasks(userId)\r\n      await fetchWeeklyTasks(userId)\r\n      return response.data.data\r\n    } catch (err) {\r\n      error.value = err.response?.data?.message || 'Failed to assign task'\r\n      throw err\r\n    } finally {\r\n      loading.value = false\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear task data\r\n   */\r\n  const clearTasks = () => {\r\n    dailyTasks.value = []\r\n    weeklyTasks.value = []\r\n    error.value = null\r\n  }\r\n\r\n  return {\r\n    // State\r\n    loading,\r\n    error,\r\n    dailyTasks,\r\n    weeklyTasks,\r\n    // Getters\r\n    todayTasks,\r\n    weekTasks,\r\n    // Actions\r\n    fetchDailyTasks,\r\n    fetchWeeklyTasks,\r\n    completeTask,\r\n    assignTask,\r\n    clearTasks\r\n  }\r\n})\r\n\r\n","/**\r\n * Composable for automatic task completion\r\n * Detects user actions and automatically completes related tasks\r\n */\r\nimport { ref } from 'vue'\r\nimport { useAuthStore } from '@/stores/auth'\r\nimport { useGlobalDataStore } from '@/stores/globalData'\r\nimport { useTaskStore } from '@/stores/taskStore'\r\nimport api from '@/lib/api'\r\nimport endpoints from '@/lib/endpoints'\r\n\r\n// Task title mappings for automatic detection\r\nconst TASK_MAPPINGS = {\r\n  // Route-based tasks\r\n  'questions.ask': 'Ask 1 Question',\r\n  'questions.index': null, // No specific task\r\n  'tasks.index': null, // No specific task\r\n  \r\n  // Action-based tasks (handled in components)\r\n  'question_created': 'Ask 1 Question',\r\n  'answer_created': 'Answer 1 Question',\r\n  // Profile visits are tracked automatically by backend when viewing someone else's profile\r\n}\r\n\r\n// Track completed tasks in this session to avoid duplicate calls\r\nconst completedTasks = ref(new Set())\r\n\r\nexport function useAutoTaskCompletion() {\r\n  const authStore = useAuthStore()\r\n  const globalDataStore = useGlobalDataStore()\r\n  const taskStore = useTaskStore()\r\n\r\n  /**\r\n   * Complete a task automatically by title\r\n   * @param {string} taskTitle - The title of the task to complete\r\n   * @param {boolean} silent - If true, don't show toast notifications\r\n   */\r\n  const completeTaskByTitle = async (taskTitle, silent = false) => {\r\n    if (!authStore.isAuthenticated || !authStore.user?.id) {\r\n      return false\r\n    }\r\n\r\n    // Check if already completed in this session\r\n    const taskKey = `${taskTitle}-${new Date().toDateString()}`\r\n    if (completedTasks.value.has(taskKey)) {\r\n      return false\r\n    }\r\n\r\n    try {\r\n      const response = await api.post(endpoints.tasks.autoComplete(), {\r\n        task_title: taskTitle\r\n      })\r\n\r\n      if (response.data.success) {\r\n        const task = response.data.data\r\n        \r\n        // Mark as completed in session\r\n        completedTasks.value.add(taskKey)\r\n\r\n        // Refresh global data to update UI\r\n        await globalDataStore.fetchGlobalData({ force: true })\r\n\r\n        // XP toast will be shown via realtime notification from backend\r\n        // when UserCompletedTask event is broadcast\r\n\r\n        return true\r\n      }\r\n    } catch (error) {\r\n      // Silently fail - task might not exist or already completed\r\n      // Don't show error to user for automatic completions\r\n      console.debug('[AutoTask] Task completion failed:', error.response?.data?.message || error.message)\r\n      return false\r\n    }\r\n\r\n    return false\r\n  }\r\n\r\n  /**\r\n   * Complete task based on route name\r\n   * @param {string} routeName - Vue router route name\r\n   */\r\n  const completeTaskByRoute = async (routeName) => {\r\n    const taskTitle = TASK_MAPPINGS[routeName]\r\n    \r\n    if (!taskTitle) {\r\n      return false\r\n    }\r\n\r\n    return await completeTaskByTitle(taskTitle, false)\r\n  }\r\n\r\n  /**\r\n   * Complete task based on action\r\n   * @param {string} action - Action name (e.g., 'question_created', 'answer_created')\r\n   */\r\n  const completeTaskByAction = async (action) => {\r\n    const taskTitle = TASK_MAPPINGS[action]\r\n    \r\n    if (!taskTitle) {\r\n      return false\r\n    }\r\n\r\n    return await completeTaskByTitle(taskTitle, false)\r\n  }\r\n\r\n  /**\r\n   * Clear completed tasks cache (useful for testing or reset)\r\n   */\r\n  const clearCompletedCache = () => {\r\n    completedTasks.value.clear()\r\n  }\r\n\r\n  return {\r\n    completeTaskByTitle,\r\n    completeTaskByRoute,\r\n    completeTaskByAction,\r\n    clearCompletedCache,\r\n  }\r\n}\r\n\r\n"],"names":["useTaskStore","defineStore","loading","ref","error","dailyTasks","weeklyTasks","todayTasks","computed","weekTasks","fetchDailyTasks","userId","response","api","endpoints","err","_b","_a","fetchWeeklyTasks","taskId","TASK_MAPPINGS","completedTasks","useAutoTaskCompletion","authStore","useAuthStore","globalDataStore","useGlobalDataStore","completeTaskByTitle","taskTitle","silent","taskKey","task","_c","routeName","action"],"mappings":"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"}