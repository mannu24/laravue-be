import{_ as Ie,t as ze,j as Ee,p as i,a as ce,q as Ne,R as Pe,l as le,a8 as Me,b as n,D as l,f as T,d as c,u as a,L as Be,w as U,H as j,C as re,x as d,K as ve,z as u,ar as de,F as E,E as N,A as v,X as ge,T as Ke,I as oe,k as Le,J as Oe,o as r,N as He}from"./app-Bvnl7d0n.js";import{_ as L}from"./Input-CjQgemiQ.js";import{_ as pe}from"./Card-hOl-Usuy.js";import{_ as me}from"./CardContent-BNEtnmat.js";import{_ as fe}from"./EmptyState-DVLWfdwK.js";import{F as ye}from"./file-text-CMcMhd5a.js";import{M as Je}from"./message-square-I2NocKB-.js";import{U as Xe}from"./users-BD_gwi77.js";import{F as Ge}from"./folder-open-BnUa1mLa.js";import{S as he}from"./search-5LIDw_UH.js";import{F as xe}from"./filter-CS8K0kRv.js";import{C as We}from"./chevron-down-CF7e_OBe.js";import{C as Ye}from"./chevron-up-ClYMuBWv.js";import{U as Ze}from"./user-DmW1QfWA.js";import{T as Qe}from"./tag-6Idb4Hv2.js";import{C as be}from"./calendar-TcdMNaSw.js";import{L as ke}from"./loader-circle-D-hWkZPx.js";import{C as et}from"./chevron-right-Cq0N1iJW.js";import{u as _e}from"./index-B71ycLCJ.js";import"./activity-BXHlTU9J.js";import"./bookmark-Afub3nbE.js";import"./code-xml-5bxqMtxa.js";const tt={class:"min-h-screen"},at={class:"max-w-6xl mx-auto py-5"},st={class:"mb-8"},lt={class:"mb-6"},rt={class:"flex gap-3 items-center"},ot={class:"relative flex-1"},nt={class:"space-y-4"},ut={class:"flex flex-wrap gap-4 items-center justify-between"},it={class:"flex flex-wrap items-center gap-4"},ct={class:"flex items-center gap-2"},vt=["value"],dt={class:"flex items-center gap-2"},gt=["value"],pt={key:2,class:"ml-1 px-1.5 py-0.5 text-xs rounded-full bg-primary text-primary-foreground"},mt={class:"font-medium"},ft={key:0,class:"text-xs ml-1"},yt={class:"space-y-6"},ht={class:"flex items-center justify-between mb-4"},xt={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},bt={class:"space-y-2"},kt={class:"relative"},_t=["onClick"],wt=["src","alt"],Dt={key:1,class:"w-8 h-8 rounded-full bg-gray-300 flex items-center justify-center text-xs font-bold"},qt={class:"flex-1 min-w-0"},Ct={class:"space-y-2"},St={class:"relative"},Tt=["onClick"],jt={key:0,class:"flex flex-wrap gap-2 mt-2"},Ft=["onClick"],$t={class:"space-y-2"},Rt={class:"space-y-2"},Ut={key:0,class:"flex items-center justify-center py-20"},Vt={key:1,class:"space-y-4"},At={class:"flex items-start gap-4 w-full"},It={class:"flex-1 min-w-0"},zt={class:"flex items-center gap-2 mb-2"},Et={key:0},Nt={key:1},Pt={key:2},Mt={key:3},Bt={key:2,class:"flex flex-wrap gap-2 mt-3"},Kt={__name:"SearchResults",setup(Lt){const p=Pe(),J=Le(),o=ze(),X=Ee(),x=i(""),b=i({posts:[],questions:[],users:[],projects:[]}),V=i(!1),P=i(!1),A=i(1),we=i(25),G=i(0),ne=i(1),I=i(!0),W=i(0),m=i("all"),M=i("relevance"),B=i(null),Y=i(null),O=i(!1),w=i(""),f=i(null),D=i(""),g=i([]),y=i(""),h=i(""),q=i([]),F=i([]),$=i(!1),R=i(!1),De=i(null),qe=i(null),Ce=[{value:"all",label:"All"},{value:"post",label:"Posts"},{value:"question",label:"Questions"},{value:"user",label:"Users"},{value:"project",label:"Projects"}],Se=[{value:"relevance",label:"Relevance"},{value:"date",label:"Newest"},{value:"trending",label:"Trending"},{value:"popular",label:"Popular"}],Z=ce(()=>{const s=[];return(m.value==="all"||m.value==="post")&&s.push(...b.value.posts.map(t=>({...t,icon:ye}))),(m.value==="all"||m.value==="question")&&s.push(...b.value.questions.map(t=>({...t,icon:Je}))),(m.value==="all"||m.value==="user")&&s.push(...b.value.users.map(t=>({...t,icon:Xe}))),(m.value==="all"||m.value==="project")&&s.push(...b.value.projects.map(t=>({...t,icon:Ge}))),s}),H=async(s=!1)=>{var t,e,C,S,ae;if(!(x.value.length<3)){if(s){if(P.value||!I.value)return;P.value=!0}else{if(V.value)return;V.value=!0,A.value=1,b.value={posts:[],questions:[],users:[],projects:[]},I.value=!0}try{const z=new URLSearchParams({q:x.value,type:m.value,sort:M.value,page:A.value.toString(),per_page:we.value.toString()});(t=f.value)!=null&&t.username&&z.append("author",f.value.username),g.value.length>0&&z.append("tags",g.value.join(",")),y.value&&z.append("date_from",y.value),h.value&&z.append("date_to",h.value);const se=await oe.get(`/api/v1/search?${z.toString()}`,X.config);if(se.data.status==="success"&&se.data.data){const _=se.data.data;if(s?b.value={posts:[...b.value.posts,..._.posts||[]],questions:[...b.value.questions,..._.questions||[]],users:[...b.value.users,..._.users||[]],projects:[...b.value.projects,..._.projects||[]]}:b.value={posts:_.posts||[],questions:_.questions||[],users:_.users||[],projects:_.projects||[]},G.value=((e=_.meta)==null?void 0:e.total_results)||0,ne.value=((C=_.meta)==null?void 0:C.total_pages)||1,W.value=((S=_.meta)==null?void 0:S.search_time)||0,I.value=A.value<ne.value,!s){const K={q:x.value,type:m.value,sort:M.value};(ae=f.value)!=null&&ae.username&&(K.author=f.value.username),g.value.length>0&&(K.tags=g.value.join(",")),y.value&&(K.date_from=y.value),h.value&&(K.date_to=h.value),J.replace({query:K})}I.value&&(await Oe(),te())}}catch(z){console.error("Search error:",z)}finally{s?P.value=!1:V.value=!1}}},Te=s=>{s.url?J.push(s.url):s.type==="user"&&s.username&&J.push(`/@${s.username}`)},je=()=>{I.value&&!P.value&&!V.value&&(A.value++,H(!0))},k=()=>{A.value=1,H(!1)},Q=_e(async s=>{if(s.length<2){F.value=[],R.value=!1;return}try{const t=await oe.get(`/api/v1/search/tag-suggestions?q=${encodeURIComponent(s)}`,X.config);t.data.status==="success"&&(F.value=t.data.data.tags||[],R.value=F.value.length>0)}catch(t){console.error("Error fetching tag suggestions:",t),F.value=[],R.value=!1}},300),ee=_e(async s=>{if(s.length<2){q.value=[],$.value=!1;return}try{const t=await oe.get(`/api/v1/search/user-suggestions?q=${encodeURIComponent(s)}`,X.config);t.data.status==="success"&&(q.value=t.data.data.users||[],$.value=q.value.length>0)}catch(t){console.error("Error fetching user suggestions:",t),q.value=[],$.value=!1}},300),Fe=s=>{D.value=s.target.value,Q(D.value)},ue=s=>{const t=s.trim();t&&!g.value.includes(t)&&(g.value.push(t),D.value="",F.value=[],R.value=!1,k())},$e=s=>{g.value=g.value.filter(t=>t!==s),k()},Re=s=>{s.key==="Enter"&&D.value.trim()?(s.preventDefault(),ue(D.value)):s.key==="Escape"&&(R.value=!1)},Ue=s=>{f.value=s,w.value=s.username,q.value=[],$.value=!1,k()},Ve=()=>{f.value=null,w.value="",q.value=[],$.value=!1,k()},Ae=()=>{f.value=null,w.value="",g.value=[],D.value="",y.value="",h.value="",k()},ie=ce(()=>f.value!==null||g.value.length>0||y.value||h.value),te=()=>{B.value&&B.value.disconnect();const s={root:null,rootMargin:"200px",threshold:.1};B.value=new IntersectionObserver(t=>{t.forEach(e=>{e.isIntersecting&&I.value&&!P.value&&!V.value&&je()})},s),Y.value&&B.value.observe(Y.value)};return Ne(()=>{x.value=p.query.q||"",m.value=p.query.type||"all",M.value=p.query.sort||"relevance",A.value=1,p.query.author&&(w.value=p.query.author,ee(p.query.author).then(()=>{const s=q.value.find(t=>t.username===p.query.author);s&&(f.value=s)})),p.query.tags&&(g.value=p.query.tags.split(",").filter(s=>s.trim())),p.query.date_from&&(y.value=p.query.date_from),p.query.date_to&&(h.value=p.query.date_to),x.value.length>=3&&H(!1).then(()=>{te()})}),le(()=>p.query,s=>{s.q&&s.q!==x.value&&(x.value=s.q,A.value=1,m.value=s.type||"all",M.value=s.sort||"relevance",s.author?w.value=s.author:(f.value=null,w.value=""),s.tags?g.value=s.tags.split(",").filter(t=>t.trim()):g.value=[],s.date_from?y.value=s.date_from:y.value="",s.date_to?h.value=s.date_to:h.value="",H(!1).then(()=>{te()}))},{immediate:!1}),le(D,s=>{s?Q(s):(F.value=[],R.value=!1)}),le(w,s=>{s&&!f.value?ee(s):s||(q.value=[],$.value=!1)}),Me(()=>{B.value&&B.value.disconnect()}),(s,t)=>(r(),n("div",tt,[l("div",at,[l("div",st,[t[20]||(t[20]=l("h1",{class:"text-3xl font-bold mb-6 text-gray-900 dark:text-white"}," Search Results ",-1)),l("div",lt,[l("div",rt,[l("div",ot,[c(a(he),{class:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 pointer-events-none z-10 text-gray-500 dark:text-gray-400"}),c(a(L),{modelValue:x.value,"onUpdate:modelValue":t[0]||(t[0]=e=>x.value=e),type:"text",placeholder:"Search posts, questions, projects, users...",class:"pl-10 pr-4 h-11",onKeyup:Be(k,["enter"])},null,8,["modelValue"])]),c(a(re),{onClick:k,disabled:V.value||x.value.length<3,class:"h-11 px-6"},{default:U(()=>[c(a(he),{class:"h-4 w-4 mr-2"}),t[12]||(t[12]=j(" Search ",-1))]),_:1},8,["disabled"])])]),l("div",nt,[l("div",ut,[l("div",it,[l("div",ct,[c(a(xe),{class:u(["h-4 w-4 flex-shrink-0",[a(o).isDark?"text-gray-400":"text-gray-600"]])},null,8,["class"]),ve(l("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>m.value=e),onChange:k,class:u(["px-3 py-2 rounded-md border text-sm h-10 min-w-[120px] bg-background",[a(o).isDark?"border-gray-800 bg-gray-900 text-white":"border-gray-300 bg-white text-gray-900"]])},[(r(),n(E,null,N(Ce,e=>l("option",{key:e.value,value:e.value},v(e.label),9,vt)),64))],34),[[de,m.value]])]),l("div",dt,[l("span",{class:u(["text-sm whitespace-nowrap",[a(o).isDark?"text-gray-400":"text-gray-600"]])},"Sort by:",2),ve(l("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>M.value=e),onChange:k,class:u(["px-3 py-2 rounded-md border text-sm h-10 min-w-[130px] bg-background",[a(o).isDark?"border-gray-800 bg-gray-900 text-white":"border-gray-300 bg-white text-gray-900"]])},[(r(),n(E,null,N(Se,e=>l("option",{key:e.value,value:e.value},v(e.label),9,gt)),64))],34),[[de,M.value]])]),c(a(re),{variant:"outline",size:"sm",onClick:t[3]||(t[3]=e=>O.value=!O.value),class:"h-10 gap-2"},{default:U(()=>[c(a(xe),{class:"h-4 w-4"}),t[13]||(t[13]=j(" Advanced Filters ",-1)),O.value?(r(),T(a(Ye),{key:1,class:"h-4 w-4"})):(r(),T(a(We),{key:0,class:"h-4 w-4"})),ie.value?(r(),n("span",pt,v((f.value?1:0)+g.value.length+(y.value?1:0)+(h.value?1:0)),1)):d("",!0)]),_:1})]),G.value>0?(r(),n("div",{key:0,class:u(["text-sm whitespace-nowrap",[a(o).isDark?"text-gray-400":"text-gray-600"]])},[l("span",mt,v(G.value),1),t[14]||(t[14]=j(" results found ",-1)),W.value>0?(r(),n("span",ft," ("+v(W.value)+"ms) ",1)):d("",!0)],2)):d("",!0)]),c(Ke,{name:"slide-down"},{default:U(()=>[O.value?(r(),T(a(pe),{key:0,class:u(["border-0 shadow-lg",a(o).isDark?"bg-gray-900 border-gray-800":"bg-white border-gray-200"])},{default:U(()=>[c(a(me),{class:"p-6"},{default:U(()=>[l("div",yt,[l("div",ht,[l("h3",{class:u(["text-lg font-semibold",[a(o).isDark?"text-white":"text-gray-900"]])}," Advanced Filters ",2),ie.value?(r(),T(a(re),{key:0,variant:"ghost",size:"sm",onClick:Ae,class:"text-xs"},{default:U(()=>[...t[15]||(t[15]=[j(" Clear All ",-1)])]),_:1})):d("",!0)]),l("div",xt,[l("div",bt,[l("label",{class:u(["text-sm font-medium flex items-center gap-2",[a(o).isDark?"text-gray-300":"text-gray-700"]])},[c(a(Ze),{class:"h-4 w-4"}),t[16]||(t[16]=j(" Author ",-1))],2),l("div",kt,[c(a(L),{ref_key:"authorInputRef",ref:De,modelValue:w.value,"onUpdate:modelValue":t[4]||(t[4]=e=>w.value=e),type:"text",placeholder:"Search by username...",class:"pr-8",onFocus:t[5]||(t[5]=e=>a(ee)(w.value)),onBlur:t[6]||(t[6]=e=>s.setTimeout(()=>$.value=!1,200))},null,8,["modelValue"]),f.value?(r(),T(a(ge),{key:0,onClick:Ve,class:u(["absolute right-2 top-1/2 transform -translate-y-1/2 h-4 w-4 cursor-pointer",[a(o).isDark?"text-gray-400 hover:text-gray-300":"text-gray-500 hover:text-gray-700"]])},null,8,["class"])):d("",!0),$.value&&q.value.length>0?(r(),n("div",{key:1,class:u(["absolute z-50 w-full mt-1 max-h-60 overflow-y-auto rounded-lg border shadow-lg",[a(o).isDark?"bg-gray-900 border-gray-800":"bg-white border-gray-200"]])},[(r(!0),n(E,null,N(q.value,e=>{var C,S;return r(),n("div",{key:e.id,onClick:ae=>Ue(e),class:"flex items-center gap-3 px-4 py-2 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors"},[e.avatar?(r(),n("img",{key:0,src:e.avatar,alt:e.name,class:"w-8 h-8 rounded-full"},null,8,wt)):(r(),n("div",Dt,v(((C=e.name)==null?void 0:C.charAt(0))||((S=e.username)==null?void 0:S.charAt(0))),1)),l("div",qt,[l("div",{class:u(["text-sm font-medium truncate",[a(o).isDark?"text-white":"text-gray-900"]])},v(e.name),3),l("div",{class:u(["text-xs truncate",[a(o).isDark?"text-gray-400":"text-gray-500"]])}," @"+v(e.username),3)])],8,_t)}),128))],2)):d("",!0)])]),l("div",Ct,[l("label",{class:u(["text-sm font-medium flex items-center gap-2",[a(o).isDark?"text-gray-300":"text-gray-700"]])},[c(a(Qe),{class:"h-4 w-4"}),t[17]||(t[17]=j(" Tags ",-1))],2),l("div",St,[c(a(L),{ref_key:"tagInputRef",ref:qe,modelValue:D.value,"onUpdate:modelValue":t[7]||(t[7]=e=>D.value=e),type:"text",placeholder:"Type and press Enter...",class:"pr-8",onInput:Fe,onKeydown:Re,onFocus:t[8]||(t[8]=e=>a(Q)(D.value)),onBlur:t[9]||(t[9]=e=>s.setTimeout(()=>R.value=!1,200))},null,8,["modelValue"]),R.value&&F.value.length>0?(r(),n("div",{key:0,class:u(["absolute z-50 w-full mt-1 max-h-60 overflow-y-auto rounded-lg border shadow-lg",[a(o).isDark?"bg-gray-900 border-gray-800":"bg-white border-gray-200"]])},[(r(!0),n(E,null,N(F.value,e=>(r(),n("div",{key:e,onClick:C=>ue(e),class:u(["px-4 py-2 cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-sm",[a(o).isDark?"text-white":"text-gray-900"]])},v(e),11,Tt))),128))],2)):d("",!0)]),g.value.length>0?(r(),n("div",jt,[(r(!0),n(E,null,N(g.value,e=>(r(),n("div",{key:e,class:u(["inline-flex items-center gap-1.5 px-2.5 py-1 rounded-md text-xs font-medium",[a(o).isDark?"bg-blue-900/30 text-blue-400 border border-blue-800":"bg-blue-100 text-blue-700 border border-blue-200"]])},[j(v(e)+" ",1),l("button",{onClick:C=>$e(e),class:"hover:opacity-70 transition-opacity"},[c(a(ge),{class:"h-3 w-3"})],8,Ft)],2))),128))])):d("",!0)]),l("div",$t,[l("label",{class:u(["text-sm font-medium flex items-center gap-2",[a(o).isDark?"text-gray-300":"text-gray-700"]])},[c(a(be),{class:"h-4 w-4"}),t[18]||(t[18]=j(" Date From ",-1))],2),c(a(L),{modelValue:y.value,"onUpdate:modelValue":t[10]||(t[10]=e=>y.value=e),type:"date",onChange:k,class:"w-full"},null,8,["modelValue"])]),l("div",Rt,[l("label",{class:u(["text-sm font-medium flex items-center gap-2",[a(o).isDark?"text-gray-300":"text-gray-700"]])},[c(a(be),{class:"h-4 w-4"}),t[19]||(t[19]=j(" Date To ",-1))],2),c(a(L),{modelValue:h.value,"onUpdate:modelValue":t[11]||(t[11]=e=>h.value=e),type:"date",min:y.value,onChange:k,class:"w-full"},null,8,["modelValue","min"])])])])]),_:1})]),_:1},8,["class"])):d("",!0)]),_:1})])]),V.value?(r(),n("div",Ut,[c(a(ke),{class:u(["h-8 w-8 animate-spin",[a(o).isDark?"text-gray-400":"text-gray-500"]])},null,8,["class"])])):Z.value.length>0?(r(),n("div",Vt,[(r(!0),n(E,null,N(Z.value,(e,C)=>(r(),T(a(pe),{key:`${e.type}-${e.id||e.username||C}`,onClick:S=>Te(e),class:u(["cursor-pointer transition-all duration-200 hover:shadow-lg group",[a(o).isDark?"bg-gray-900 border-gray-800 hover:border-gray-700":"bg-white border-gray-200 hover:border-gray-300"]])},{default:U(()=>[c(a(me),{class:"p-6"},{default:U(()=>[l("div",At,[l("div",{class:u(["flex-shrink-0 w-12 h-12 rounded-lg flex items-center justify-center",[e.type==="post"?a(o).isDark?"bg-blue-900/30 text-blue-400":"bg-blue-100 text-blue-600":e.type==="question"?a(o).isDark?"bg-green-900/30 text-green-400":"bg-green-100 text-green-600":e.type==="project"?a(o).isDark?"bg-purple-900/30 text-purple-400":"bg-purple-100 text-purple-600":a(o).isDark?"bg-orange-900/30 text-orange-400":"bg-orange-100 text-orange-600"]])},[(r(),T(He(e.icon||a(ye)),{class:"h-6 w-6"}))],2),l("div",It,[l("div",zt,[l("span",{class:u(["text-xs font-medium px-2 py-1 rounded capitalize",[e.type==="post"?a(o).isDark?"bg-blue-900/30 text-blue-400":"bg-blue-100 text-blue-600":e.type==="question"?a(o).isDark?"bg-green-900/30 text-green-400":"bg-green-100 text-green-600":e.type==="project"?a(o).isDark?"bg-purple-900/30 text-purple-400":"bg-purple-100 text-purple-600":a(o).isDark?"bg-orange-900/30 text-orange-400":"bg-orange-100 text-orange-600"]])},v(e.type),3),e.author?(r(),n("span",{key:0,class:u(["text-xs",[a(o).isDark?"text-gray-400":"text-gray-500"]])}," by @"+v(typeof e.author=="object"?e.author.username:e.author),3)):d("",!0),e.posted_at?(r(),n("span",{key:1,class:u(["text-xs",[a(o).isDark?"text-gray-500":"text-gray-400"]])}," â€¢ "+v(e.posted_at),3)):d("",!0)]),l("h3",{class:u(["text-lg font-semibold mb-2",[a(o).isDark?"text-white":"text-gray-900"]])},v(e.title||e.name||e.username),3),e.content||e.description?(r(),n("p",{key:0,class:u(["text-sm mb-3 line-clamp-2",[a(o).isDark?"text-gray-400":"text-gray-600"]])},v(e.content||e.description),3)):d("",!0),e.stats?(r(),n("div",{key:1,class:u(["flex items-center gap-4 text-sm",[a(o).isDark?"text-gray-500":"text-gray-400"]])},[e.stats.likes!==void 0?(r(),n("span",Et," â¤ï¸ "+v(e.stats.likes),1)):d("",!0),e.stats.comments!==void 0?(r(),n("span",Nt," ðŸ’¬ "+v(e.stats.comments),1)):d("",!0),e.stats.answers!==void 0?(r(),n("span",Pt," ðŸ’¡ "+v(e.stats.answers),1)):d("",!0),e.stats.views!==void 0?(r(),n("span",Mt," ðŸ‘ï¸ "+v(e.stats.views),1)):d("",!0)],2)):d("",!0),e.tags&&e.tags.length>0?(r(),n("div",Bt,[(r(!0),n(E,null,N(e.tags,S=>(r(),n("span",{key:S,class:u(["text-xs px-2 py-1 rounded",[a(o).isDark?"bg-gray-800 text-gray-300":"bg-gray-100 text-gray-700"]])},v(S),3))),128))])):d("",!0)]),c(a(et),{class:u(["h-5 w-5 flex-shrink-0 mt-1 transition-transform group-hover:translate-x-1",[a(o).isDark?"text-gray-600":"text-gray-400"]])},null,8,["class"])])]),_:2},1024)]),_:2},1032,["onClick","class"]))),128)),l("div",{ref_key:"loadMoreTrigger",ref:Y,class:"h-20 flex items-center justify-center"},[P.value?(r(),n("div",{key:0,class:u(["flex items-center gap-2 text-sm",[a(o).isDark?"text-gray-400":"text-gray-600"]])},[c(a(ke),{class:"h-5 w-5 animate-spin"}),t[21]||(t[21]=l("span",null,"Loading more results...",-1))],2)):!I.value&&Z.value.length>0?(r(),n("div",{key:1,class:u(["text-sm py-8",[(a(o).isDark,"text-gray-500")]])}," No more results to load ",2)):d("",!0)],512)])):x.value.length>=3?(r(),T(fe,{key:2,icon:"Search",title:"No results found",subtitle:"Try different keywords or filters",size:"default"})):(r(),T(fe,{key:3,icon:"Search",title:"Start searching",subtitle:"Enter at least 3 characters to search",size:"default"}))])]))}},ga=Ie(Kt,[["__scopeId","data-v-5fdcb34b"]]);export{ga as default};
//# sourceMappingURL=SearchResults-B68NZFC2.js.map
