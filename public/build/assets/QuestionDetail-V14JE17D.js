import{c as Y,f as M,o as p,w as n,r as te,z as N,u as t,e as le,af as oe,n as re,h as ie,ag as ue,m as de,ah as ce,ai as pe,p as b,b as _,F as Q,E as W,D as a,x as R,d as s,H as h,A as v,C as x,aj as ve,j as me,a as H,J as fe,q as he,I as F,l as ye,k as _e}from"./app-BusCMfsw.js";import{_ as P}from"./Card-rloiMM0U.js";import{_ as D}from"./CardContent-DRH463jB.js";import{_ as ge}from"./CardDescription-CtTeBqrV.js";import{_ as J}from"./CardFooter-BhG9KwgQ.js";import{_ as K,a as G}from"./CardTitle-BaSWMxRf.js";import{a as se,_ as xe}from"./BackNavigator-CgEjaoQ9.js";import{C as X}from"./chevron-up-BBxhchHE.js";import{M as ae}from"./message-square-Bg3vIftc.js";import{L as we}from"./LoadingSpinner-CXD8z_2h.js";import{U as ke}from"./user-CaHqtWKQ.js";import{E as be}from"./eye-dx6brfk1.js";import{C as $e}from"./circle-alert-CVqoJgI8.js";/**
 * @license lucide-vue-next v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=Y("CircleChevronUpIcon",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m8 14 4-4 4 4",key:"fy2ptz"}]]);/**
 * @license lucide-vue-next v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=Y("LockIcon",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-vue-next v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=Y("PenLineIcon",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]]),Z={__name:"Avatar",props:{class:{type:null,required:!1},size:{type:null,required:!1,default:"sm"},shape:{type:null,required:!1,default:"circle"}},setup(f){const g=f;return(w,m)=>(p(),M(t(oe),{class:N(t(le)(t(ze)({size:f.size,shape:f.shape}),g.class))},{default:n(()=>[te(w.$slots,"default")]),_:3},8,["class"]))}},O={__name:"AvatarFallback",props:{delayMs:{type:Number,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},setup(f){const g=f;return(w,m)=>(p(),M(t(ue),re(ie(g)),{default:n(()=>[te(w.$slots,"default")]),_:3},16))}},ee={__name:"AvatarImage",props:{src:{type:String,required:!0},referrerPolicy:{type:null,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},setup(f){const g=f;return(w,m)=>(p(),M(t(ce),de(g,{class:"h-full w-full object-cover"}),null,16))}},ze=pe("inline-flex items-center justify-center font-normal text-foreground select-none shrink-0 bg-secondary overflow-hidden",{variants:{size:{sm:"h-10 w-10 text-xs",base:"h-16 w-16 text-2xl",lg:"h-32 w-32 text-5xl"},shape:{circle:"rounded-full",square:"rounded-md"}}}),Le={class:"space-y-4"},Re={class:"flex items-center justify-between gap-4 px-5 py-4 bg-card border border-gray-200 dark:border-gray-800 rounded-lg shadow"},Ue=["innerHTML"],Me={class:"flex items-center gap-4 text-sm text-gray-500"},Se={class:"flex items-center gap-2"},Ve={class:"flex items-center justify-between mt-4"},je={class:"flex flex-col items-end gap-2"},Be={key:0,class:"mt-4 border-l-2 border-primary pl-4"},Fe={class:"flex justify-end mt-2 space-x-2"},Te={key:0,class:"mt-2"},Ee={class:"flex gap-4 p-4 bg-white dark:bg-black border border-gray-200 dark:border-gray-800 rounded-lg shadow"},Ie={class:"flex-1"},He=["innerHTML"],Pe={class:"flex items-center justify-between mt-4"},De={class:"flex items-center gap-4 text-sm text-gray-500"},Ne={class:"flex items-center gap-2"},Ye={class:"flex flex-col items-end gap-2"},Qe={key:0,class:"flex items-center gap-1"},We=["onClick"],Je={class:"text-sm font-medium"},Ke={key:0,class:"ml-6 pl-4 mt-2"},Ge={__name:"AnswersWithReplies",props:{items:{type:Array,required:!0},authUserId:{type:Number,required:!0},maxReplies:{type:Number,default:0}},emits:["reply","upvote"],setup(f,{emit:g}){const w=f,m=g,A=b({}),y=b({});b({});const U=b({}),$=o=>{A.value[o]=!A.value[o],A.value[o]||(y.value[o]="")},S=o=>{const c=y.value[o];c!=null&&c.trim()&&(m("reply",{parentId:o,content:c}),$(o))},d=o=>{U.value[o]=!U.value[o]},q=o=>{const c=w.items.find(r=>r.id===o);return!c||!c.replies?[]:U.value[o]?c.replies:c.replies.slice(0,w.maxReplies)},z=o=>new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric"}).format(new Date(o)),V=o=>o?o.split(" ").map(c=>c[0]).join("").toUpperCase():"?";return(o,c)=>(p(),_("div",Le,[(p(!0),_(Q,null,W(f.items,r=>{var T;return p(),_("div",{key:r.id,class:N(["relative",{"pl-[20px]":o.depth>0}])},[a("div",Re,[a("div",null,[a("div",{innerHTML:r.body,class:"prose dark:prose-invert max-w-none text-sm mb-4"},null,8,Ue),a("div",Me,[a("div",Se,[s(t(Z),{class:"h-6 w-6 bg-red-700"},{default:n(()=>{var u;return[s(t(ee),{src:(u=r.user)==null?void 0:u.avatar_url},null,8,["src"]),s(t(O),{class:"text-white"},{default:n(()=>{var L;return[h(v(V((L=r.user)==null?void 0:L.name)),1)]}),_:2},1024)]}),_:2},1024),a("div",null,v(((T=r.user)==null?void 0:T.name)||"Anonymous")+" • "+v(z(r.created_at)),1)])])]),a("div",null,[a("div",Ve,[a("div",je,[s(t(x),{onClick:()=>{var u;return((u=r.user)==null?void 0:u.id)!==f.authUserId?o.$emit("upvote",r.id):null},variant:"red",size:"sm",class:N({"text-primary":r.hasUpvoted})},{default:n(()=>[s(t(X),{class:"h-4 w-4"}),h(" "+v(r.upvotes_count||r.upvotes||0),1)]),_:2},1032,["onClick","class"]),s(t(x),{variant:"ghost",size:"sm",onClick:u=>$(r.id)},{default:n(()=>[s(t(ae),{class:"h-4 w-4 mr-1"}),c[0]||(c[0]=h(" Reply ",-1))]),_:1},8,["onClick"])])]),A.value[r.id]?(p(),_("div",Be,[s(se,{modelValue:y.value[r.id],"onUpdate:modelValue":u=>y.value[r.id]=u,placeholder:"Write your reply...","min-height":100},null,8,["modelValue","onUpdate:modelValue"]),a("div",Fe,[s(t(x),{variant:"outline",size:"sm",onClick:u=>$(r.id)},{default:n(()=>[...c[1]||(c[1]=[h("Cancel",-1)])]),_:1},8,["onClick"]),s(t(x),{size:"sm",onClick:u=>S(r.id)},{default:n(()=>[...c[2]||(c[2]=[h("Post Reply",-1)])]),_:1},8,["onClick"])])])):R("",!0)])]),r.replies&&r.replies.length>0?(p(),_("div",Te,[(p(!0),_(Q,null,W(q(r.id),u=>{var L,E;return p(),_("div",{key:u.id,class:"ml-6 border-l-2 border-gray-200 pl-4 py-2"},[a("div",Ee,[a("div",Ie,[a("div",{innerHTML:u.content,class:"prose dark:prose-invert max-w-none text-sm"},null,8,He),a("div",Pe,[a("div",De,[a("div",Ne,[s(t(Z),{class:"h-6 w-6"},{default:n(()=>{var j;return[s(t(ee),{src:(j=u.user)==null?void 0:j.avatar_url},null,8,["src"]),s(t(O),{class:"text-white"},{default:n(()=>{var I;return[h(v(V((I=u.user)==null?void 0:I.name)),1)]}),_:2},1024)]}),_:2},1024),a("span",null,v(((L=u.user)==null?void 0:L.name)||"Anonymous"),1)]),a("span",null,v(z(u.created_at)),1)]),a("div",Ye,[((E=u.user)==null?void 0:E.id)!==f.authUserId?(p(),_("div",Qe,[a("button",{onClick:j=>o.$emit("upvote",{id:u.id,type:"answer"}),class:"p-2 rounded hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"},[s(t(X),{class:"h-4 w-4"})],8,We),a("span",Je,v(u.upvotes_count||0),1)])):R("",!0)])])])])])}),128)),r.replies.length>f.maxReplies?(p(),_("div",Ke,[s(t(x),{variant:"ghost",size:"sm",onClick:u=>d(r.id),class:"text-gray-500 hover:text-gray-700 dark:hover:text-gray-400"},{default:n(()=>[h(v(U.value[r.id]?"Show Less":`Show More (${r.replies.length-f.maxReplies} more)`),1)]),_:2},1032,["onClick"])])):R("",!0)])):R("",!0)],2)}),128))]))}},Xe={class:"max-w-4xl mx-auto py-8 px-4"},Ze={key:0,class:"text-center"},Oe={key:1,class:"space-y-6"},et={class:"flex items-center justify-between"},tt=["innerHTML"],st={class:"flex space-x-4"},at={class:"flex items-center space-x-1"},nt={class:"text-sm text-gray-500"},lt={key:0,class:"flex items-center space-x-1"},ot={class:"text-sm text-gray-500"},rt={class:"flex justify-between mt-4"},it={class:"text-lg font-medium"},ut={class:"space-x-4"},dt={class:"space-y-4"},ct={key:2,class:"text-center py-12"},Ct={__name:"QuestionDetail",setup(f){const g=fe(),w=_e(),{toast:m}=ve(),A=me(),y=H(()=>A.token),U=H(()=>{var l;return(l=A.user)==null?void 0:l.id}),$=b(!1),S=b(null),d=b(null),q=b([]),z=b(""),V=b(!0),o=b(!1),c=[{name:"Questions",href:"/qna"},{name:g.params.slug,href:"/qna/"+g.params.slug}],r=H(()=>{if(!d.value)return"";const l=d.value.content||d.value.body||"";if(!l)return"";const e=300;return l.length<=e||o.value?l:l.slice(0,e)+"..."}),T=H(()=>d.value?(d.value.content||d.value.body||"").length>300:!1);he(async()=>{var l,e;S.value=g.params.slug;try{await u()}catch(i){m({title:"Error",description:((e=(l=i==null?void 0:i.response)==null?void 0:l.data)==null?void 0:e.message)||"Failed to fetch question details.",variant:"destructive"})}finally{V.value=!1}});const u=async()=>{const l=await F.get(`/api/v1/questions/${S.value}`);d.value=l.data.data.question,q.value=l.data.data.answers||[]};ye(g.params.slug,l=>{S.value=l,u()});const L=async()=>{var l,e;try{const i=await F.post(`/api/v1/questions/${d.value.id}/answers`,{content:z.value},{headers:{Authorization:`Bearer ${y.value}`}});q.value.push(i.data.data),z.value="",$.value=!1,m({title:"Answer submitted",description:"Your answer has been posted."})}catch(i){m({title:"Error",description:((e=(l=i==null?void 0:i.response)==null?void 0:l.data)==null?void 0:e.message)||"Failed to submit answer.",variant:"destructive"})}},E=async()=>{var l,e;if(!y.value)return m({title:"Authentication required",description:"Log in to upvote.",variant:"warning"});try{await F.post(`/api/v1/questions/${d.value.id}/upvote`,{},{headers:{Authorization:`Bearer ${y.value}`}}),d.value.upvotes_count++,m({title:"Upvoted",description:"You upvoted this question."})}catch(i){m({title:"Error",description:((e=(l=i==null?void 0:i.response)==null?void 0:l.data)==null?void 0:e.message)||"Failed to upvote question.",variant:"destructive"})}},j=async({parentId:l,content:e})=>{var i,B;if(!y.value)return m({title:"Authentication required",description:"Log in to reply.",variant:"warning"});try{const k=await F.post(`/api/v1/answers/${l}/replies`,{content:e},{headers:{Authorization:`Bearer ${y.value}`}});m({title:"Reply submitted",description:"Your reply has been posted."}),await u()}catch(k){m({title:"Error",description:((B=(i=k==null?void 0:k.response)==null?void 0:i.data)==null?void 0:B.message)||"Failed to submit reply.",variant:"destructive"})}},I=async l=>{var i,B;if(!y.value)return m({title:"Authentication required",description:"Log in to upvote.",variant:"warning"});const e=typeof l=="object"?l.id:l;try{await F.post(`/api/v1/answers/${e}/upvote`,{},{headers:{Authorization:`Bearer ${y.value}`}});const k=ne=>{for(const C of ne){if(C.id===e)return C.upvotes_count!==void 0?C.upvotes_count=(C.upvotes_count||0)+1:C.upvotes!==void 0&&(C.upvotes=(C.upvotes||0)+1),!0;if(C.replies&&C.replies.length>0&&k(C.replies))return!0}return!1};k(q.value),m({title:"Upvoted",description:"You upvoted this answer."})}catch(k){m({title:"Error",description:((B=(i=k==null?void 0:k.response)==null?void 0:i.data)==null?void 0:B.message)||"Failed to upvote answer.",variant:"destructive"})}};return(l,e)=>(p(),_("div",Xe,[V.value?(p(),_("div",Ze,[s(we,{size:"lg"}),e[6]||(e[6]=a("p",{class:"mt-2 text-gray-600"},"Loading question...",-1))])):d.value?(p(),_("div",Oe,[s(xe,{items:c}),s(t(P),null,{default:n(()=>[s(t(K),null,{default:n(()=>[a("div",et,[s(t(G),{class:"text-2xl font-bold"},{default:n(()=>[h(v(d.value.title),1)]),_:1}),s(t(x),{onClick:E,variant:"outline",size:"sm",class:"flex items-center space-x-1"},{default:n(()=>[s(t(Ce),{class:"h-6 w-6"}),a("span",null,v(d.value.upvotes_count),1)]),_:1})]),s(t(ge),{class:"flex items-center space-x-2 text-sm text-gray-500"},{default:n(()=>[s(t(ke),{class:"h-4 w-4"}),a("span",null,v(d.value.user?d.value.user.name:"Anonymous"),1),e[7]||(e[7]=a("span",null,"•",-1)),a("span",null,v(d.value.created_at),1)]),_:1})]),_:1}),s(t(D),null,{default:n(()=>[a("div",{innerHTML:r.value,class:"prose max-w-none"},null,8,tt),T.value?(p(),M(t(x),{key:0,onClick:e[0]||(e[0]=i=>o.value=!o.value),variant:"link",class:"mt-2"},{default:n(()=>[h(v(o.value?"Show less":"Read more"),1)]),_:1})):R("",!0)]),_:1}),s(t(J),{class:"flex justify-between items-center"},{default:n(()=>[a("div",st,[a("span",at,[s(t(ae),{class:"h-4 w-4 text-gray-500"}),a("span",nt,v((q.value||[]).length)+" Answers",1)]),d.value.views_count?(p(),_("span",lt,[s(t(be),{class:"h-4 w-4 text-gray-500"}),a("span",ot,v(d.value.views_count)+" Views",1)])):R("",!0)])]),_:1})]),_:1}),a("div",rt,[a("h2",it,v((q.value||[]).length)+" Answers",1),s(t(x),{variant:"outline",size:"lg",onClick:e[1]||(e[1]=i=>$.value=!$.value),class:"gap-2"},{default:n(()=>[s(t(Ae),{class:"h-4 w-4"}),h(" "+v($.value?"Cancel Answer Writing":"Write an Answer"),1)]),_:1})]),$.value&&y.value?(p(),M(t(P),{key:0,class:"mt-4"},{default:n(()=>[s(t(K),null,{default:n(()=>[s(t(G),null,{default:n(()=>[...e[8]||(e[8]=[h("Your Answer",-1)])]),_:1})]),_:1}),s(t(D),null,{default:n(()=>[s(se,{modelValue:z.value,"onUpdate:modelValue":e[2]||(e[2]=i=>z.value=i),placeholder:"Write your answer...","min-height":300},null,8,["modelValue"])]),_:1}),s(t(J),{class:"flex justify-end"},{default:n(()=>[s(t(x),{onClick:L},{default:n(()=>[...e[9]||(e[9]=[h("Post Your Answer",-1)])]),_:1})]),_:1})]),_:1})):$.value&&!y.value?(p(),M(t(P),{key:1},{default:n(()=>[s(t(D),{class:"text-center py-6"},{default:n(()=>[s(t(qe),{class:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e[12]||(e[12]=a("p",{class:"text-lg font-semibold mb-2"},"Sign up or log in to answer",-1)),e[13]||(e[13]=a("p",{class:"text-gray-500 mb-4"},"You need to be logged in to post an answer to this question.",-1)),a("div",ut,[s(t(x),{onClick:e[3]||(e[3]=i=>t(w).push("/login"))},{default:n(()=>[...e[10]||(e[10]=[h("Log in",-1)])]),_:1}),s(t(x),{onClick:e[4]||(e[4]=i=>t(w).push("/signup")),variant:"outline"},{default:n(()=>[...e[11]||(e[11]=[h("Sign up",-1)])]),_:1})])]),_:1})]),_:1})):R("",!0),a("div",dt,[s(Ge,{items:q.value||[],"auth-user-id":U.value,"max-replies":2,onReply:j,onUpvote:I},null,8,["items","auth-user-id"])])])):(p(),_("div",ct,[s(t($e),{class:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e[15]||(e[15]=a("p",{class:"text-xl font-semibold"},"Question not found",-1)),e[16]||(e[16]=a("p",{class:"text-gray-500 mt-2"},"The question you're looking for doesn't seem to exist.",-1)),s(t(x),{onClick:e[5]||(e[5]=i=>t(w).push("/questions")),variant:"link",class:"mt-4"},{default:n(()=>[...e[14]||(e[14]=[h("Browse all questions",-1)])]),_:1})]))]))}};export{Ct as default};
//# sourceMappingURL=QuestionDetail-V14JE17D.js.map
