{"version":3,"file":"UserProfile-BebdPkVC.js","sources":["../../../resources/js/composables/useFollow.js","../../../resources/js/views/UserProfile.vue"],"sourcesContent":["import { ref } from 'vue'\r\nimport axios from 'axios'\r\nimport { useAuthStore } from '../stores/auth'\r\n\r\nexport function useFollow() {\r\n    const authStore = useAuthStore()\r\n    const isFollowing = ref(false)\r\n    const isLoading = ref(false)\r\n    const followersCount = ref(0)\r\n    const followingCount = ref(0)\r\n\r\n    /**\r\n     * Toggle follow/unfollow a user\r\n     * @param {string} username - Username of the user to follow/unfollow\r\n     * @returns {Promise<boolean>} - Returns true if successful, false otherwise\r\n     */\r\n    const toggleFollow = async (username) => {\r\n        if (!authStore.isAuthenticated) {\r\n            console.warn('Authentication required to follow users')\r\n            return false\r\n        }\r\n\r\n        if (isLoading.value) {\r\n            return false\r\n        }\r\n\r\n        isLoading.value = true\r\n\r\n        try {\r\n            const response = await axios.post(\r\n                `/api/v1/users/${username}/follow`,\r\n                {},\r\n                authStore.config\r\n            )\r\n\r\n            if (response.data.status === 'success') {\r\n                isFollowing.value = response.data.data.is_following\r\n                followersCount.value = response.data.data.user.followers_count\r\n                followingCount.value = response.data.data.user.following_count\r\n\r\n                return true\r\n            }\r\n\r\n            return false\r\n        } catch (error) {\r\n            console.error('Follow toggle error:', error.response?.data || error.message)\r\n            return false\r\n        } finally {\r\n            isLoading.value = false\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Check if current user is following a specific user\r\n     * @param {string} username - Username to check\r\n     */\r\n    const checkFollowStatus = async (username) => {\r\n        if (!authStore.isAuthenticated) {\r\n            isFollowing.value = false\r\n            return\r\n        }\r\n\r\n        try {\r\n            const response = await axios.get(\r\n                `/api/v1/users/${username}/follow/check`,\r\n                authStore.config\r\n            )\r\n\r\n            if (response.data.status === 'success') {\r\n                isFollowing.value = response.data.data.is_following\r\n                followersCount.value = response.data.data.user.followers_count\r\n                followingCount.value = response.data.data.user.following_count\r\n            }\r\n        } catch (error) {\r\n            console.error('Error checking follow status:', error)\r\n            isFollowing.value = false\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Initialize follow state\r\n     * @param {string} username - Username to initialize for\r\n     * @param {Object} userData - Optional user data with follow counts\r\n     */\r\n    const initialize = (username, userData = null) => {\r\n        if (userData) {\r\n            isFollowing.value = userData.is_following || false\r\n            followersCount.value = userData.followers_count || 0\r\n            followingCount.value = userData.following_count || 0\r\n        } else {\r\n            checkFollowStatus(username)\r\n        }\r\n    }\r\n\r\n    return {\r\n        isFollowing,\r\n        isLoading,\r\n        followersCount,\r\n        followingCount,\r\n        toggleFollow,\r\n        checkFollowStatus,\r\n        initialize\r\n    }\r\n}\r\n\r\n","<script setup>\nimport { ref, computed, onMounted, watch, onBeforeMount } from 'vue'\nimport { useRoute } from 'vue-router'\nimport { useAuthStore } from '../stores/auth'\nimport { useThemeStore } from '../stores/theme'\nimport { useFollow } from '../composables/useFollow'\nimport ProfileTabs from '../components/profile/ProfileTabs.vue'\nimport ProfileCard from '../components/profile/ProfileCard.vue'\nimport { \n    Users, \n    Building2,\n    FileText\n} from 'lucide-vue-next'\nimport api from '@/lib/api'\nimport { useGlobalDataStore } from '../stores/globalData'\n\n// Declare emits to avoid Vue warnings\ndefineEmits(['share_url'])\n\nconst route = useRoute()\nconst authStore = useAuthStore()\nconst themeStore = useThemeStore()\nconst globalDataStore = useGlobalDataStore()\nconst username = ref(null)\n\nconst user = ref(null)\nconst isLoading = ref(true)\nconst isOwnProfile = computed(() => {\n    return authStore.isAuthenticated && authStore.user?.username === username.value\n})\n\nconst { isFollowing, followersCount, followingCount } = useFollow()\n\n// Computed for gamification data\nconst gamificationSummary = computed(() => {\n  // Get from API response if available, otherwise from globalDataStore\n  if (user.value?.gamification?.summary) {\n    return user.value.gamification.summary\n  }\n  return globalDataStore.gamificationSummary\n})\n\n// Fetch user profile\nconst fetchUserProfile = async () => {\n    isLoading.value = true\n    try {\n        // Use api instance which automatically attaches auth token\n        const response = await api.get(`/users/${username.value}`)\n        \n        if (response.data.status === 'success') {\n            // Handle both old format (data) and new format (data.user)\n            user.value = response.data.data.user || response.data.data\n            followersCount.value = user.value?.followers_count || 0\n            followingCount.value = user.value?.following_count || 0\n            \n            // Set follow status from API response\n            if (authStore.isAuthenticated && !isOwnProfile.value) {\n                isFollowing.value = user.value?.is_following || false\n            }\n            \n            // Store gamification data if available\n            if (response.data.data.gamification) {\n                user.value.gamification = response.data.data.gamification\n            }\n        }\n    } catch (error) {\n        console.error('Error fetching user profile:', error)\n        user.value = null\n    } finally {\n        isLoading.value = false\n    }\n}\n\n// Handle route updates when navigating to same route with different params\nonBeforeMount(async (to, from) => {\n    if (to.params.username !== from.params.username) {\n        username.value = to.params.username\n        await fetchUserProfile()\n    }\n})\n\n// Watch route params to handle navigation changes (fallback)\nwatch(() => route.params.username, (newUsername) => {\n    if (newUsername && newUsername !== username.value) {\n        username.value = newUsername\n        fetchUserProfile()\n    }\n})\n\nonMounted(async () => {\n    username.value = route.params.username\n    await fetchUserProfile()\n    // Fetch global data if gamification not in response\n    if (!user.value?.gamification) {\n        await globalDataStore.fetchGlobalData()\n    }\n})\n</script>\n\n<template>\n    <div class=\"min-h-screen\">\n        <!-- Loading State -->\n        <div v-if=\"isLoading\" class=\"flex items-center justify-center min-h-screen\">\n            <div class=\"text-center\">\n                <div class=\"animate-spin rounded-full h-12 w-12 border-b-2 mx-auto mb-4\" :class=\"[\n                    themeStore.isDark ? 'border-white' : 'border-gray-900'\n                ]\"></div>\n                <p :class=\"[\n                    themeStore.isDark ? 'text-gray-400' : 'text-gray-600'\n                ]\">Loading profile...</p>\n            </div>\n        </div>\n\n        <!-- Profile Content -->\n        <div v-else-if=\"user\">\n            <ProfileCard\n                :user=\"user\"\n                :social-links=\"user.social_links || []\"\n                :gamification-summary=\"gamificationSummary\"\n            />\n\n            <!-- Tabs Section -->\n            <div class=\"container mx-auto px-4 sm:px-6 lg:px-8 pb-24 -mt-8\">\n                <ProfileTabs\n                    :user-id=\"user?.id\"\n                    :tabs=\"[\n                        { value: 'feed', label: 'Feed', icon: FileText },\n                        { value: 'projects', label: 'Projects', icon: Building2 },\n                        // { value: 'blogs', label: 'Blogs', icon: FileText }\n                    ]\"\n                    default-tab=\"feed\"\n                    :username=\"username\"\n                    :is-own-profile=\"isOwnProfile\"\n                />\n            </div>\n        </div>\n\n        <!-- Error State -->\n        <div v-else class=\"flex items-center justify-center min-h-screen\">\n            <div class=\"text-center\">\n                <Users class=\"h-16 w-16 mx-auto mb-4 opacity-50\" :class=\"[\n                    themeStore.isDark ? 'text-gray-600' : 'text-gray-400'\n                ]\" />\n                <h2 class=\"text-2xl font-bold mb-2\" :class=\"[\n                    themeStore.isDark ? 'text-white' : 'text-gray-900'\n                ]\">User Not Found</h2>\n                <p :class=\"[\n                    themeStore.isDark ? 'text-gray-400' : 'text-gray-600'\n                ]\">The user you're looking for doesn't exist.</p>\n            </div>\n        </div>\n    </div>\n</template>\n\n<style scoped>\n.fade-enter-active,\n.fade-leave-active {\n    transition: opacity 0.3s ease;\n}\n\n.fade-enter-from,\n.fade-leave-to {\n    opacity: 0;\n}\n</style>\n"],"names":["useFollow","authStore","useAuthStore","isFollowing","ref","isLoading","followersCount","followingCount","toggleFollow","username","response","axios","error","_a","checkFollowStatus","userData","route","useRoute","themeStore","useThemeStore","globalDataStore","useGlobalDataStore","user","isOwnProfile","computed","gamificationSummary","_b","fetchUserProfile","api","_c","onBeforeMount","to","from","watch","newUsername","onMounted","_openBlock","_createElementBlock","_hoisted_1","_hoisted_2","_createElementVNode","_hoisted_3","_unref","_normalizeClass","_hoisted_4","_createVNode","ProfileCard","_hoisted_5","ProfileTabs","FileText","Building2","_hoisted_6","_hoisted_7","Users"],"mappings":"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"}